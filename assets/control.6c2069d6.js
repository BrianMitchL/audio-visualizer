import"./index.1dd16ad5.js";import{r as a,u as w,j as e,a as m,v as z,b as x,E as v,c as b,B as S}from"./index.f2c2ac5c.js";function I({deviceId:i,fftSize:d}){const[o,n]=a.exports.useState(null),c=w("audio"),[r,t]=a.exports.useState(null);return a.exports.useEffect(()=>{async function l(){const f=await navigator.mediaDevices.getUserMedia({audio:{deviceId:i},video:!1}),s=f.getAudioTracks()[0];s!=null&&s.label&&t({name:s.label});const u=new window.AudioContext,h=new window.AnalyserNode(u,{minDecibels:-90,maxDecibels:-10,smoothingTimeConstant:.85});h.fftSize=d,u.createMediaStreamSource(f).connect(h,0),n(h)}return l(),()=>{n(null),t(null)}},[i,d]),a.exports.useEffect(()=>{if(!o)return;const l=o.frequencyBinCount,f=setInterval(()=>{if(!c.current)return;const s=new Uint8Array(l);o.getByteFrequencyData(s),c.current.postMessage(s)},5);return()=>{clearInterval(f)}},[o,c]),e("div",{children:r?m("p",{children:["Playing from audio source ",e("code",{children:r.name}),"."]}):null})}function D({fftSize:i}){const[d,o]=a.exports.useState([]),[n,c]=a.exports.useState(null);return a.exports.useEffect(()=>{async function r(){const t=await navigator.mediaDevices.enumerateDevices();o(t.filter(l=>l.kind==="audioinput"))}r()},[]),a.exports.useEffect(()=>{async function r(){const t=await navigator.mediaDevices.getUserMedia({audio:!0});c(t.id)}n||r()},[n]),m("details",{children:[e("summary",{children:"Audio Input Devices"}),e("p",{children:"Select an input device. If device names aren't showing up, please allow microphone/audio access in your browser, and mark it to remember your decision or always allow, and then reload the page."}),e("ul",{children:d.map(r=>e("li",{children:e("button",{onClick:()=>c(r.deviceId),"aria-pressed":r.deviceId===n,children:r.label||`Unknown device ${r.deviceId}`.trim()})},r.deviceId))}),n?e(I,{deviceId:n,fftSize:i}):null]})}const C="_alert_1360i_1",g={alert:C,"new-visualizer-window":"_new-visualizer-window_1360i_8","inline-form":"_inline-form_1360i_13"};function A({id:i}){const d=w("control"),o=a.exports.useId();return m("section",{children:[m("h2",{children:["Visualizer - ",i]}),m("form",{className:g["inline-form"],onSubmit:n=>{n.preventDefault();const c=new FormData(n.currentTarget).get("visualizer");if(typeof c=="string"&&d.current){const r={name:"set-visualizer",data:{viewId:i,visualizerFileName:c}};d.current.postMessage(r)}},children:[e("label",{htmlFor:o,children:"Visualizer"}),e("select",{id:o,name:"visualizer",required:!0,children:z.map(n=>e("option",{value:n.id,children:n.display},n.id))}),e("button",{type:"submit",children:"Set Visualizer"})]})]})}const y=[];for(let i=5;i<16;i+=1)y.push(2**i);function E(){const i=w("control");x("control");const[d,o]=a.exports.useState([]),[n,c]=a.exports.useState(32),r=a.exports.useId();return a.exports.useEffect(()=>{const t=i.current;if(!t)return;const l=f=>{o(s=>{const u=f.data;switch(u.name){case"register":return s.concat([u.data]);case"unregister":return s.filter(h=>h.id!==u.data.id);case"ping":return s.find(p=>p.id===u.data.id)?s.map(p=>p.id===u.data.id?u.data:p):s.concat([u.data]);default:return s}})};return t.addEventListener("message",l),()=>{t.removeEventListener("message",l)}},[i]),m("div",{children:[d.filter(t=>t.type==="control").length>1?m("p",{role:"alert",className:g.alert,children:[e("strong",{children:"Warning"}),", using more than one control at a time is not supported.",null]}):null,e("a",{href:"../visualizer/",target:"_blank",rel:"noreferrer noopener",className:g["new-visualizer-window"],children:"Open New Visualizer"}),e(v,{children:e(D,{fftSize:n})}),m("form",{className:g["inline-form"],onSubmit:t=>{t.preventDefault();const l=new FormData(t.currentTarget).get("fftSize");typeof l=="string"&&c(Number(l))},children:[e("label",{htmlFor:r,children:"Frequency Bins"}),e("select",{id:r,name:"fftSize",children:y.map(t=>e("option",{value:t,children:(t/2).toLocaleString()},t))}),e("button",{type:"submit",children:"Set Frequency Bins"})]}),d.filter(t=>t.type==="visualizer").map(t=>e(A,{id:t.id},t.id))]})}b(document.getElementById("root")).render(e(a.exports.StrictMode,{children:e(S,{children:e(v,{children:e(E,{})})})}));
